## Лабораторная работа № 8. Обзор диспетчера ресурсов файлового сервера (FSRM). Управление квотами, файловым экранированием и отчётами

### Цель работы
Изучить функционал Диспетчера ресурсов файлового сервера (FSRM) в Windows Server, освоить практические навыки:
* настройки квотирования дискового пространства;
* создания правил файлового экранирования;
* генерации отчётов по использованию хранилища.

### Теоретические сведения

**FSRM (File Server Resource Manager)** — роль Windows Server для управления файловыми ресурсами:
* **Квоты** — ограничение объёма данных на томах/папках.
* **Файловое экранирование** — запрет сохранения файлов по типам (расширениям).
* **Отчёты** — анализ использования диска, аудита файлов, классификации.
* **Управление классификацией** — назначение метаданных файлам.

**Ключевые сценарии применения:**
* предотвращение переполнения дисков;
* блокировка потенциально опасных файлов (`.exe`, `.bat`);
* мониторинг потребления ресурсов пользователями.

### Оборудование и ПО
* Виртуальная машина 1: Windows Server (рекомендуется Windows Server 2022/2019).
* Виртуальная машина 2: Windows 10 (для тестирования клиентского доступа).
* Гипервизор (VMware, VirtualBox, Hyper‑V).
* На сервере: дополнительный виртуальный диск (минимум 10 ГБ) для тестов.

### Ход работы

#### 1. Подготовка инфраструктуры
1. Разверните ВМ:
   * VM1: Windows Server (с ролью **Файловые службы и службы хранилища**).
   * VM2: Windows 10 (подключена к той же сети).
2. На сервере:
   * Подключите дополнительный виртуальный диск.
   * Отформатируйте его в NTFS, назначьте букву (например, `D:`).
   * Создайте папку: `D:\SharedData`.
   * Настройте общий доступ:  
     * Правая кнопка по папке → **Свойства** → вкладка **Доступ**.
     * Нажмите **Общий доступ**, добавьте группу **Все** с правами **Чтение и запись**.

#### 2. Установка роли FSRM
1. На сервере откройте **Диспетчер серверов** → **Добавить роли и компоненты**.
2. Выберите **Роль сервера** → отметьте **Файловые службы и службы хранилища** → **Диспетчер ресурсов файлового сервера**.
3. Запустите **Диспетчер ресурсов файлового сервера** (`fsrm.msc`).

#### 3. Настройка квотирования
1. Создание квоты для тома:
   * В консоли FSRM перейдите: **Квоты** → правая кнопка → **Создать квоту**.
   * Укажите путь: `D:\`.
   * Выберите шаблон: **100 GB Limit** (или задайте вручную: **Ограничение — 10 ГБ**).
   * В разделе **Оповещения** добавьте:
     * **E‑mail** (укажите тестовый адрес).
     * **Запись в журнал событий**.
     * **Запуск команды** (опционально).
   * Нажмите **Создать**.
2. Создание квоты для папки:
   * Повторите шаги, указав путь: `D:\SharedData`.
   * Выберите шаблон: **2 GB Limit with Notification** (или задайте **Ограничение — 2 ГБ**).
3. Проверка:
   * На клиенте (VM2) подключитесь к общей папке:  
     ```
     \\<IP-сервера>\SharedData
     ```
   * Попробуйте скопировать файл размером > 2 ГБ — должно появиться предупреждение.

#### 4. Настройка файлового экранирования
1. Создание группы типов файлов:
   * В консоли FSRM перейдите: **Управление типами файлов** → **Группы типов файлов**.
   * Правая кнопка → **Создать группу типов файлов**.
   * Имя: `Запрещённые расширения`.
   * Добавьте расширения: `.exe`, `.msi`, `.bat`, `.vbs`.
   * Нажмите **ОК**.
2. Создание правила экранирования:
   * Перейдите: **Файловое экранирование** → правая кнопка → **Создать правило экранирования**.
   * Путь: `D:\SharedData`.
   * Группа типов файлов: `Запрещённые расширения`.
   * Действие: **Запретить сохранение**.
   * В разделе **Уведомления** настройте:
     * E‑mail (тестовый адрес).
     * Сообщение пользователям: *«Сохранение исполняемых файлов запрещено!»*.
   * Нажмите **Создать**.
3. Тестирование:
   * На клиенте попробуйте скопировать `.exe`-файл в `SharedData` — должно появиться сообщение об ошибке.

#### 5. Генерация отчётов
1. Создание отчёта об использовании квоты:
   * В консоли FSRM перейдите: **Отчёты хранилища** → **Задачи отчётов**.
   * Правая кнопка → **Создать задачу отчёта**.
   * Имя: `Использование квоты`.
   * Тип отчёта: **Использование квоты**.
   * Объекты: `D:\`, `D:\SharedData`.
   * Расписание: **Выполнить сейчас**.
   * В разделе **Доставка** укажите:
     * Путь сохранения (например, `D:\Reports`).
     * Формат: **PDF** или **HTML**.
   * Нажмите **ОК** → **Запустить сейчас**.
2. Отчёт о файлах определённого типа:
   * Создайте задачу отчёта с типом **Файлы определённого типа**.
   * Укажите группу типов: `Запрещённые расширения`.
   * Сохраните в `D:\Reports`.
3. Анализ отчётов:
   * Откройте сгенерированные файлы в `D:\Reports`.
   * Проверьте:
     * процент использования квоты;
     * список заблокированных файлов.

#### 6. Дополнительные настройки (по желанию)
1. Шаблоны квоты:
   * Создайте собственный шаблон в **Шаблоны квоты** (например, для медиа‑файлов).
2. Классификация файлов:
   * В **Управление классификацией** настройте правила (например, по дате изменения).
3. Планирование отчётов:
   * Настройте еженедельную отправку отчётов на e‑mail администратора.

### Контрольные вопросы
1. Для чего используется FSRM? Перечислите основные функции.
2. Чем отличается квота для тома от квоты для папки?
3. Как создать правило, запрещающее сохранение `.zip`-файлов?
4. Какие типы отчётов можно генерировать в FSRM?
5. Как настроить автоматическое оповещение при превышении квоты?

### Отчёт по работе
Предоставьте:
1. Скриншот консоли `fsrm.msc` с перечнем созданных квоты и правил экранирования.
2. Скриншот окна ошибки при попытке сохранить `.exe`-файл (клиент).
3. Примеры сгенерированных отчётов (фрагменты PDF/HTML).
4. Описание возникших проблем и способов их решения (если были).
5. Ответы на контрольные вопросы.


### Вывод
В ходе лабораторной работы:
* установлена и настроена роль FSRM;
* созданы квоты для тома и папки с оповещениями;
* сконфигурировано файловое экранирование для блокировки опасных расширений;
* сгенерированы отчёты по использованию хранилища.

Подтверждена эффективность FSRM для контроля дискового пространства и обеспечения безопасности файловых ресурсов.