# Лабораторная работа
## Развёртывание и настройка почтового сервера с использованием отдельного DNS-сервера

**Специальность:** Сетевое и системное администрирование  
**Курс:** 3  
**Операционные системы:** Debian / Ubuntu Server  
**Уровень сложности:** средний  
**Форма выполнения:** индивидуально  

---

## 1. Цель лабораторной работы

Получить практические навыки развёртывания и администрирования почтового сервера в операционной системе Linux с использованием отдельного DNS-сервера, а также изучить зависимость работы почтовых сервисов от корректной DNS-настройки.

---

## 2. Задачи лабораторной работы

В процессе выполнения лабораторной работы студент должен:

- развернуть DNS-сервер в локальной сети;
- создать DNS-зону и записи для почтового домена;
- развернуть почтовый сервер на отдельной виртуальной машине;
- настроить SMTP и IMAP сервисы;
- создать локальных пользователей Linux;
- выполнить тестирование почты из консоли и почтового клиента;
- выполнить диагностику типовой ошибки почтового сервера;
- проанализировать логи почтовых сервисов.

---

## 3. Краткие теоретические сведения

**DNS (Domain Name System)** — система преобразования доменных имён в IP-адреса.  
**MX-запись** — DNS-запись, указывающая почтовый сервер домена.  
**SMTP (Simple Mail Transfer Protocol)** — протокол передачи электронной почты.  
**IMAP (Internet Message Access Protocol)** — протокол доступа пользователей к почтовым ящикам.  

---

## 4. Схема лабораторной установки

В лабораторной работе используются **две виртуальные машины**:

```

+-------------------+        +-------------------+
|   DNS-сервер      |        |   Почтовый сервер |
|                   |        |                   |
| dns.studentXX     | -----> | mail.studentXX    |
| 192.168.XX.10     |        | 192.168.XX.20     |
+-------------------+        +-------------------+

````

---

## 5. Исходные данные

| Параметр | Значение |
|--------|--------|
| Домен | `studentXX.local` |
| DNS-сервер | `dns.studentXX.local` |
| Почтовый сервер | `mail.studentXX.local` |
| Количество пользователей | 2 |
| Формат хранения почты | Maildir |

---

## 6. Используемое программное обеспечение

- Debian / Ubuntu Server  
- BIND9  
- Postfix  
- Dovecot  
- mailutils  
- Thunderbird  

---

## 7. Ход работы

### Шаг 1–9  
*(выполняются согласно основной инструкции лабораторной работы)*

---

## 8. Проверка работы почты в Thunderbird

*(раздел без изменений)*

---

## 9. Анализ логов почтового сервера

В минимальной установке файл `/var/log/mail.log` может отсутствовать.

### Вариант 1. Установка rsyslog
```bash
apt install rsyslog -y
systemctl start rsyslog
tail /var/log/mail.log
````

### Вариант 2. Использование journalctl

```bash
journalctl -u postfix
journalctl -u dovecot
```

---

## 10. Диагностика типовой ошибки Postfix

При тестировании почтового сервера в логах может появиться сообщение:

```
status=bounced (mail for studentXX.local loops back to myself)
```

### 10.1 Описание проблемы

Данная ошибка означает, что почтовый сервер пытается
отправить письмо для домена, который не определён как локальный,
и получает в DNS в качестве почтового сервера самого себя,
что приводит к зацикливанию доставки.

---

### 10.2 Проверка конфигурации

Проверить параметры Postfix:

```bash
postconf | egrep "myhostname|mydomain|mydestination"
```

Если в параметре `mydestination` отсутствует домен `studentXX.local`,
Postfix не считает его локальным.

---

### 10.3 Устранение ошибки

Открыть файл конфигурации:

```bash
nano /etc/postfix/main.cf
```

Привести параметры к следующему виду:

```
myhostname = mail.studentXX.local
mydomain = studentXX.local
myorigin = $mydomain
mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain
```

Перезапустить Postfix:

```bash
systemctl restart postfix
```

---

### 10.4 Повторное тестирование

```bash
echo "Test after fix" | mail -s "Test" user1@studentXX.local
```

В логах должна появиться запись об успешной доставке письма.

---

## 11. Контрольные вопросы

1. Почему почтовый сервер не может работать без DNS?
2. Назначение MX-записи
3. Чем отличается SMTP от IMAP?
4. Назначение параметра `mydestination`
5. Почему возникает ошибка зацикливания доставки?

---

## 12. Требования к отчёту

Отчёт должен содержать:

* схему сети;
* файл DNS-зоны;
* конфигурацию Postfix и Dovecot;
* скриншоты из Thunderbird;
* описание выявленной и устранённой ошибки;
* выводы.
